# Docker Storage 超详细整理
我把这段官方文档**逐段翻译 + 结构化梳理 + 通俗解释**，直接整理成你能立刻看懂、用来学习/面试/笔记的完整版。

---

# 一、Docker 存储两大核心概念
Docker 存储分为**完全不同的两大块**：

1. **容器数据持久化（本篇重点）**
   如何用 **Volumes、Bind mounts、tmpfs mounts** 把数据存在容器外面，让数据**独立于容器生命周期存在**。

2. **守护进程存储后端**
   Docker 如何在磁盘上存储：
    - 镜像层（image layers）
    - 容器可写层（container writable layers）
      对应技术：
    - `containerd image store`
    - `storage drivers`

---

# 二、容器层基础原理
## 默认机制：容器可写层
- 容器里创建的所有文件，默认都存在**可写层**。
- 可写层在**只读、不可变的镜像层之上**。
- 容器销毁 → 这一层数据**直接丢失**。

## 缺点
1. 数据不持久，删容器就丢数据。
2. 数据很难共享给其他进程/容器。
3. 每个容器的可写层**独立、不共享**。
4. 很难把数据从容器拷到宿主机或其他容器。

---

# 三、Docker 支持的 4 种外部存储挂载方式
所有挂载方式，**在容器内部看起来都一样**：就是一个目录或文件。

## 1. Volume 挂载（官方最推荐）
### 特点
- 由 **Docker daemon 统一管理**。
- 容器删除后，**卷依然保留**。
- 数据存在宿主机，但**不建议直接手动修改**（会损坏）。
- 性能接近直接读写宿主机文件系统。

### 适用场景
- 需要**长期持久化**的数据
- 数据库存储
- 性能敏感的应用
- 多容器共享数据

---

## 2. Bind Mount 绑定挂载
### 特点
- 直接把**宿主机任意路径**映射到容器。
- **不受 Docker 隔离**：
  宿主机进程、容器进程**都能同时修改**。

### 适用场景
- 需要**容器和宿主机双向访问文件**
- 开发时挂载代码目录
- 配置文件共享

---

## 3. tmpfs 挂载（内存挂载）
### 特点
- 数据**直接存在宿主机内存**，**不写磁盘**。
- 生命周期：
    - 容器停止/重启 → 数据丢失
    - 宿主机重启 → 数据丢失
- 完全不持久化。

### 适用场景
- 临时缓存
- 密钥、凭证等**敏感数据**
- 不想落盘、减少磁盘 I/O

---

## 4. Named Pipes 命名管道（主要 Windows）
- 用于 **宿主机 ↔ 容器之间通信**。
- 典型场景：
  容器里跑工具，通过命名管道连接宿主机 Docker API。

---

# 四、一句话总结区别（最实用）
| 类型 | 谁管理 | 持久化 | 宿主机可见 | 性能 | 典型用途 |
|------|--------|--------|------------|------|----------|
| **Volume** | Docker | ✅ 是 | 不直接推荐 | 高 | 数据库、持久存储 |
| **Bind Mount** | 用户 | ✅ 是 | 完全可见 | 高 | 开发、配置共享 |
| **tmpfs** | 内存 | ❌ 否 | 不存在 | 极高 | 临时/敏感数据 |
| **Named Pipe** | 系统 | - | 通信 | - | Windows 与 Docker API 通信 |

---

# 五、官方推荐学习路径
## 容器数据持久化
- Volumes
- Bind mounts
- tmpfs mounts

## 守护进程存储（镜像/层存储）
- containerd image store
- Storage drivers

---

如果你需要，我可以继续帮你：
- 画一张 **Docker 存储架构图**
- 出 **命令示例**（volume / bind / tmpfs 怎么用）
- 整理 **面试高频题**

你想要哪个版本？